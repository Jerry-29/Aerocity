{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 67, "column": 0}, "map": {"version":3,"sources":["file:///D:/G/Aerocity/AEROCITY-FE/Aerocity/lib/db.ts"],"sourcesContent":["// lib/db.ts - Prisma client singleton\r\nimport { PrismaClient } from \"@prisma/client\";\r\n\r\nconst globalForPrisma = global as unknown as { prisma: PrismaClient };\r\n\r\nexport const prisma =\r\n  globalForPrisma.prisma ||\r\n  new PrismaClient({\r\n    log: process.env.NODE_ENV === \"development\" ? [\"query\"] : [],\r\n  });\r\n\r\nif (process.env.NODE_ENV !== \"production\") globalForPrisma.prisma = prisma;\r\n\r\nexport default prisma;\r\n"],"names":[],"mappings":"AAAA,sCAAsC;;;;;;;AACtC;;AAEA,MAAM;AAEC,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK,uCAAyC;QAAC;KAAQ,GAAG;AAC5D;AAEF,wCAA2C,gBAAgB,MAAM,GAAG;uCAErD","debugId":null}},
    {"offset": {"line": 106, "column": 0}, "map": {"version":3,"sources":["file:///D:/G/Aerocity/AEROCITY-FE/Aerocity/lib/jwt-utils.ts"],"sourcesContent":["// lib/jwt-utils.ts - JWT token utilities\r\nimport jwt from \"jsonwebtoken\";\r\nimport type { SessionUser } from \"./auth\";\r\n\r\nconst JWT_SECRET = process.env.JWT_SECRET || \"your-jwt-secret-key-must-match-java-backend\";\r\nconst JWT_EXPIRATION = process.env.JWT_EXPIRATION || \"86400\"; // 24 hours\r\n\r\nexport interface TokenPayload {\r\n  userId: number;\r\n  mobile: string;\r\n  role: \"ADMIN\" | \"AGENT\";\r\n  iat?: number;\r\n  exp?: number;\r\n}\r\n\r\n/**\r\n * Generate JWT token\r\n */\r\nexport function generateToken(user: SessionUser): string {\r\n  const payload: TokenPayload = {\r\n    userId: user.id,\r\n    mobile: user.mobile,\r\n    role: user.role,\r\n  };\r\n\r\n  return jwt.sign(payload, JWT_SECRET, {\r\n    expiresIn: parseInt(JWT_EXPIRATION),\r\n    algorithm: \"HS256\",\r\n  });\r\n}\r\n\r\n/**\r\n * Verify and decode JWT token\r\n */\r\nexport function verifyToken(token: string): TokenPayload | null {\r\n  try {\r\n    const decoded = jwt.verify(token, JWT_SECRET, {\r\n      algorithms: [\"HS256\"],\r\n    }) as TokenPayload;\r\n    return decoded;\r\n  } catch (error) {\r\n    console.error(\"JWT verification failed:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Extract token from Authorization header\r\n */\r\nexport function extractTokenFromHeader(authHeader?: string): string | null {\r\n  if (!authHeader) return null;\r\n\r\n  const parts = authHeader.split(\" \");\r\n  if (parts.length !== 2 || parts[0].toLowerCase() !== \"bearer\") {\r\n    return null;\r\n  }\r\n\r\n  return parts[1];\r\n}\r\n\r\n/**\r\n * Extract claims from token without verification\r\n */\r\nexport function extractClaims(token: string): TokenPayload | null {\r\n  try {\r\n    const decoded = jwt.decode(token) as TokenPayload;\r\n    return decoded;\r\n  } catch (error) {\r\n    console.error(\"Failed to decode token:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Validate token expiration\r\n */\r\nexport function isTokenExpired(token: string): boolean {\r\n  const payload = extractClaims(token);\r\n  if (!payload || !payload.exp) return true;\r\n\r\n  const currentTime = Math.floor(Date.now() / 1000);\r\n  return payload.exp < currentTime;\r\n}\r\n"],"names":[],"mappings":"AAAA,yCAAyC;;;;;;;;;;;;;AACzC;;AAGA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAC7C,MAAM,iBAAiB,QAAQ,GAAG,CAAC,cAAc,IAAI,SAAS,WAAW;AAalE,SAAS,cAAc,IAAiB;IAC7C,MAAM,UAAwB;QAC5B,QAAQ,KAAK,EAAE;QACf,QAAQ,KAAK,MAAM;QACnB,MAAM,KAAK,IAAI;IACjB;IAEA,OAAO,2MAAG,CAAC,IAAI,CAAC,SAAS,YAAY;QACnC,WAAW,SAAS;QACpB,WAAW;IACb;AACF;AAKO,SAAS,YAAY,KAAa;IACvC,IAAI;QACF,MAAM,UAAU,2MAAG,CAAC,MAAM,CAAC,OAAO,YAAY;YAC5C,YAAY;gBAAC;aAAQ;QACvB;QACA,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO;IACT;AACF;AAKO,SAAS,uBAAuB,UAAmB;IACxD,IAAI,CAAC,YAAY,OAAO;IAExB,MAAM,QAAQ,WAAW,KAAK,CAAC;IAC/B,IAAI,MAAM,MAAM,KAAK,KAAK,KAAK,CAAC,EAAE,CAAC,WAAW,OAAO,UAAU;QAC7D,OAAO;IACT;IAEA,OAAO,KAAK,CAAC,EAAE;AACjB;AAKO,SAAS,cAAc,KAAa;IACzC,IAAI;QACF,MAAM,UAAU,2MAAG,CAAC,MAAM,CAAC;QAC3B,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2BAA2B;QACzC,OAAO;IACT;AACF;AAKO,SAAS,eAAe,KAAa;IAC1C,MAAM,UAAU,cAAc;IAC9B,IAAI,CAAC,WAAW,CAAC,QAAQ,GAAG,EAAE,OAAO;IAErC,MAAM,cAAc,KAAK,KAAK,CAAC,KAAK,GAAG,KAAK;IAC5C,OAAO,QAAQ,GAAG,GAAG;AACvB","debugId":null}},
    {"offset": {"line": 174, "column": 0}, "map": {"version":3,"sources":["file:///D:/G/Aerocity/AEROCITY-FE/Aerocity/app/api/auth/login/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { cookies } from \"next/headers\";\nimport bcrypt from \"bcryptjs\";\nimport { prisma } from \"@/lib/db\";\nimport { generateToken } from \"@/lib/jwt-utils\";\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const { type, email, mobile, password } = body;\n    const isAdmin = type === \"admin\";\n\n    if (!password || (isAdmin ? !email : !mobile)) {\n      return NextResponse.json(\n        { message: \"Missing required login fields\" },\n        { status: 400 },\n      );\n    }\n\n    const user = await prisma.user.findFirst({\n      where: isAdmin\n        ? { email: email, role: \"ADMIN\" }\n        : { mobile: mobile, role: \"AGENT\" },\n    });\n\n    if (!user) {\n      return NextResponse.json({ message: \"Invalid credentials\" }, { status: 401 });\n    }\n\n    if (user.status !== \"ACTIVE\") {\n      return NextResponse.json(\n        { message: `Account is ${user.status.toLowerCase()}` },\n        { status: 403 },\n      );\n    }\n\n    const passwordOk = await bcrypt.compare(password, user.passwordHash);\n    if (!passwordOk) {\n      return NextResponse.json({ message: \"Invalid credentials\" }, { status: 401 });\n    }\n\n    const sessionUser = {\n      id: user.id,\n      name: user.name,\n      email: user.email || undefined,\n      mobile: user.mobile,\n      role: user.role,\n      status: user.status,\n    };\n    const token = generateToken(sessionUser);\n\n    const cookieStore = await cookies();\n    cookieStore.set(\n      \"aerocity_auth\",\n      JSON.stringify({\n        token,\n        user: {\n          id: sessionUser.id,\n          name: sessionUser.name,\n          email: sessionUser.email,\n          mobile: sessionUser.mobile,\n          role: sessionUser.role,\n          status: sessionUser.status,\n        },\n      }),\n      {\n        httpOnly: true,\n        secure: process.env.NODE_ENV === \"production\",\n        sameSite: \"lax\",\n        path: \"/\",\n        maxAge: 60 * 60 * 24, // 24 hours\n      },\n    );\n\n    return NextResponse.json({\n      user: {\n        id: sessionUser.id,\n        name: sessionUser.name,\n        email: sessionUser.email,\n        mobile: sessionUser.mobile,\n        role: sessionUser.role,\n        status: sessionUser.status,\n      },\n      token,\n    });\n  } catch (error) {\n    console.error(\"Login API error:\", error);\n    return NextResponse.json(\n      { message: \"Something went wrong. Please try again.\", error: String(error) },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;;;;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,MAAM,EAAE,QAAQ,EAAE,GAAG;QAC1C,MAAM,UAAU,SAAS;QAEzB,IAAI,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,MAAM,GAAG;YAC7C,OAAO,gRAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;YAAgC,GAC3C;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,OAAO,MAAM,qHAAM,CAAC,IAAI,CAAC,SAAS,CAAC;YACvC,OAAO,UACH;gBAAE,OAAO;gBAAO,MAAM;YAAQ,IAC9B;gBAAE,QAAQ;gBAAQ,MAAM;YAAQ;QACtC;QAEA,IAAI,CAAC,MAAM;YACT,OAAO,gRAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAAsB,GAAG;gBAAE,QAAQ;YAAI;QAC7E;QAEA,IAAI,KAAK,MAAM,KAAK,UAAU;YAC5B,OAAO,gRAAY,CAAC,IAAI,CACtB;gBAAE,SAAS,CAAC,WAAW,EAAE,KAAK,MAAM,CAAC,WAAW,IAAI;YAAC,GACrD;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,aAAa,MAAM,mMAAM,CAAC,OAAO,CAAC,UAAU,KAAK,YAAY;QACnE,IAAI,CAAC,YAAY;YACf,OAAO,gRAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAAsB,GAAG;gBAAE,QAAQ;YAAI;QAC7E;QAEA,MAAM,cAAc;YAClB,IAAI,KAAK,EAAE;YACX,MAAM,KAAK,IAAI;YACf,OAAO,KAAK,KAAK,IAAI;YACrB,QAAQ,KAAK,MAAM;YACnB,MAAM,KAAK,IAAI;YACf,QAAQ,KAAK,MAAM;QACrB;QACA,MAAM,QAAQ,IAAA,sIAAa,EAAC;QAE5B,MAAM,cAAc,MAAM,IAAA,4QAAO;QACjC,YAAY,GAAG,CACb,iBACA,KAAK,SAAS,CAAC;YACb;YACA,MAAM;gBACJ,IAAI,YAAY,EAAE;gBAClB,MAAM,YAAY,IAAI;gBACtB,OAAO,YAAY,KAAK;gBACxB,QAAQ,YAAY,MAAM;gBAC1B,MAAM,YAAY,IAAI;gBACtB,QAAQ,YAAY,MAAM;YAC5B;QACF,IACA;YACE,UAAU;YACV,QAAQ,oDAAyB;YACjC,UAAU;YACV,MAAM;YACN,QAAQ,KAAK,KAAK;QACpB;QAGF,OAAO,gRAAY,CAAC,IAAI,CAAC;YACvB,MAAM;gBACJ,IAAI,YAAY,EAAE;gBAClB,MAAM,YAAY,IAAI;gBACtB,OAAO,YAAY,KAAK;gBACxB,QAAQ,YAAY,MAAM;gBAC1B,MAAM,YAAY,IAAI;gBACtB,QAAQ,YAAY,MAAM;YAC5B;YACA;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,oBAAoB;QAClC,OAAO,gRAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAA2C,OAAO,OAAO;QAAO,GAC3E;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}