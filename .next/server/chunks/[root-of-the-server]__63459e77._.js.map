{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 79, "column": 0}, "map": {"version":3,"sources":["file:///D:/G/Aerocity/AEROCITY-FE/Aerocity/lib/jwt-utils.ts"],"sourcesContent":["// lib/jwt-utils.ts - JWT token utilities\r\nimport jwt from \"jsonwebtoken\";\r\nimport type { SessionUser } from \"./auth\";\r\n\r\nconst JWT_SECRET = process.env.JWT_SECRET || \"your-jwt-secret-key-must-match-java-backend\";\r\nconst JWT_EXPIRATION = process.env.JWT_EXPIRATION || \"86400\"; // 24 hours\r\n\r\nexport interface TokenPayload {\r\n  userId: number;\r\n  mobile: string;\r\n  role: \"ADMIN\" | \"AGENT\";\r\n  iat?: number;\r\n  exp?: number;\r\n}\r\n\r\n/**\r\n * Generate JWT token\r\n */\r\nexport function generateToken(user: SessionUser): string {\r\n  const payload: TokenPayload = {\r\n    userId: user.id,\r\n    mobile: user.mobile,\r\n    role: user.role,\r\n  };\r\n\r\n  return jwt.sign(payload, JWT_SECRET, {\r\n    expiresIn: parseInt(JWT_EXPIRATION),\r\n    algorithm: \"HS256\",\r\n  });\r\n}\r\n\r\n/**\r\n * Verify and decode JWT token\r\n */\r\nexport function verifyToken(token: string): TokenPayload | null {\r\n  try {\r\n    const decoded = jwt.verify(token, JWT_SECRET, {\r\n      algorithms: [\"HS256\"],\r\n    }) as TokenPayload;\r\n    return decoded;\r\n  } catch (error) {\r\n    console.error(\"JWT verification failed:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Extract token from Authorization header\r\n */\r\nexport function extractTokenFromHeader(authHeader?: string): string | null {\r\n  if (!authHeader) return null;\r\n\r\n  const parts = authHeader.split(\" \");\r\n  if (parts.length !== 2 || parts[0].toLowerCase() !== \"bearer\") {\r\n    return null;\r\n  }\r\n\r\n  return parts[1];\r\n}\r\n\r\n/**\r\n * Extract claims from token without verification\r\n */\r\nexport function extractClaims(token: string): TokenPayload | null {\r\n  try {\r\n    const decoded = jwt.decode(token) as TokenPayload;\r\n    return decoded;\r\n  } catch (error) {\r\n    console.error(\"Failed to decode token:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Validate token expiration\r\n */\r\nexport function isTokenExpired(token: string): boolean {\r\n  const payload = extractClaims(token);\r\n  if (!payload || !payload.exp) return true;\r\n\r\n  const currentTime = Math.floor(Date.now() / 1000);\r\n  return payload.exp < currentTime;\r\n}\r\n"],"names":[],"mappings":"AAAA,yCAAyC;;;;;;;;;;;;;AACzC;;AAGA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAC7C,MAAM,iBAAiB,QAAQ,GAAG,CAAC,cAAc,IAAI,SAAS,WAAW;AAalE,SAAS,cAAc,IAAiB;IAC7C,MAAM,UAAwB;QAC5B,QAAQ,KAAK,EAAE;QACf,QAAQ,KAAK,MAAM;QACnB,MAAM,KAAK,IAAI;IACjB;IAEA,OAAO,2MAAG,CAAC,IAAI,CAAC,SAAS,YAAY;QACnC,WAAW,SAAS;QACpB,WAAW;IACb;AACF;AAKO,SAAS,YAAY,KAAa;IACvC,IAAI;QACF,MAAM,UAAU,2MAAG,CAAC,MAAM,CAAC,OAAO,YAAY;YAC5C,YAAY;gBAAC;aAAQ;QACvB;QACA,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO;IACT;AACF;AAKO,SAAS,uBAAuB,UAAmB;IACxD,IAAI,CAAC,YAAY,OAAO;IAExB,MAAM,QAAQ,WAAW,KAAK,CAAC;IAC/B,IAAI,MAAM,MAAM,KAAK,KAAK,KAAK,CAAC,EAAE,CAAC,WAAW,OAAO,UAAU;QAC7D,OAAO;IACT;IAEA,OAAO,KAAK,CAAC,EAAE;AACjB;AAKO,SAAS,cAAc,KAAa;IACzC,IAAI;QACF,MAAM,UAAU,2MAAG,CAAC,MAAM,CAAC;QAC3B,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2BAA2B;QACzC,OAAO;IACT;AACF;AAKO,SAAS,eAAe,KAAa;IAC1C,MAAM,UAAU,cAAc;IAC9B,IAAI,CAAC,WAAW,CAAC,QAAQ,GAAG,EAAE,OAAO;IAErC,MAAM,cAAc,KAAK,KAAK,CAAC,KAAK,GAAG,KAAK;IAC5C,OAAO,QAAQ,GAAG,GAAG;AACvB","debugId":null}},
    {"offset": {"line": 153, "column": 0}, "map": {"version":3,"sources":["file:///D:/G/Aerocity/AEROCITY-FE/Aerocity/lib/db.ts"],"sourcesContent":["// lib/db.ts - Prisma client singleton\r\nimport { PrismaClient } from \"@prisma/client\";\r\n\r\nconst globalForPrisma = global as unknown as { prisma: PrismaClient };\r\n\r\nexport const prisma =\r\n  globalForPrisma.prisma ||\r\n  new PrismaClient({\r\n    log: process.env.NODE_ENV === \"development\" ? [\"query\"] : [],\r\n  });\r\n\r\nif (process.env.NODE_ENV !== \"production\") globalForPrisma.prisma = prisma;\r\n\r\nexport default prisma;\r\n"],"names":[],"mappings":"AAAA,sCAAsC;;;;;;;AACtC;;AAEA,MAAM;AAEC,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK,uCAAyC;QAAC;KAAQ,GAAG;AAC5D;AAEF,wCAA2C,gBAAgB,MAAM,GAAG;uCAErD","debugId":null}},
    {"offset": {"line": 174, "column": 0}, "map": {"version":3,"sources":["file:///D:/G/Aerocity/AEROCITY-FE/Aerocity/lib/responses.ts"],"sourcesContent":["// lib/responses.ts - Standardized API responses\r\n\r\nexport interface ApiResponseSuccess<T> {\r\n  success: boolean;\r\n  message: string;\r\n  data: T;\r\n}\r\n\r\nexport interface ApiResponseError {\r\n  success: boolean;\r\n  message: string;\r\n  error: string;\r\n  code?: string;\r\n}\r\n\r\nexport interface PaginatedResponse<T> {\r\n  success: boolean;\r\n  data: T[];\r\n  pagination: {\r\n    currentPage: number;\r\n    pageSize: number;\r\n    totalElements: number;\r\n    totalPages: number;\r\n    hasNext: boolean;\r\n    hasPrevious: boolean;\r\n  };\r\n}\r\n\r\n/**\r\n * Create a success response\r\n */\r\nexport function createSuccessResponse<T>(\r\n  message: string,\r\n  data: T,\r\n): ApiResponseSuccess<T> {\r\n  return {\r\n    success: true,\r\n    message,\r\n    data,\r\n  };\r\n}\r\n\r\n/**\r\n * Create an error response\r\n */\r\nexport function createErrorResponse(\r\n  message: string,\r\n  error: string,\r\n  code?: string,\r\n): ApiResponseError {\r\n  return {\r\n    success: false,\r\n    message,\r\n    error,\r\n    code,\r\n  };\r\n}\r\n\r\n/**\r\n * Create a paginated response\r\n */\r\nexport function createPaginatedResponse<T>(\r\n  message: string,\r\n  items: T[],\r\n  currentPage: number,\r\n  pageSize: number,\r\n  totalElements: number,\r\n): PaginatedResponse<T> & { message: string } {\r\n  const totalPages = Math.ceil(totalElements / pageSize);\r\n\r\n  return {\r\n    success: true,\r\n    message,\r\n    data: items,\r\n    pagination: {\r\n      currentPage,\r\n      pageSize,\r\n      totalElements,\r\n      totalPages,\r\n      hasNext: currentPage < totalPages,\r\n      hasPrevious: currentPage > 1,\r\n    },\r\n  } as any;\r\n}\r\n"],"names":[],"mappings":"AAAA,gDAAgD;;;;;;;;;AA+BzC,SAAS,sBACd,OAAe,EACf,IAAO;IAEP,OAAO;QACL,SAAS;QACT;QACA;IACF;AACF;AAKO,SAAS,oBACd,OAAe,EACf,KAAa,EACb,IAAa;IAEb,OAAO;QACL,SAAS;QACT;QACA;QACA;IACF;AACF;AAKO,SAAS,wBACd,OAAe,EACf,KAAU,EACV,WAAmB,EACnB,QAAgB,EAChB,aAAqB;IAErB,MAAM,aAAa,KAAK,IAAI,CAAC,gBAAgB;IAE7C,OAAO;QACL,SAAS;QACT;QACA,MAAM;QACN,YAAY;YACV;YACA;YACA;YACA;YACA,SAAS,cAAc;YACvB,aAAa,cAAc;QAC7B;IACF;AACF","debugId":null}},
    {"offset": {"line": 218, "column": 0}, "map": {"version":3,"sources":["file:///D:/G/Aerocity/AEROCITY-FE/Aerocity/lib/errors.ts"],"sourcesContent":["// lib/errors.ts - Custom error classes\r\n\r\nexport class ApiError extends Error {\r\n  constructor(\r\n    public message: string,\r\n    public status: number = 400,\r\n    public code?: string,\r\n  ) {\r\n    super(message);\r\n    this.name = \"ApiError\";\r\n  }\r\n}\r\n\r\nexport class ValidationError extends ApiError {\r\n  constructor(message: string, public field?: string) {\r\n    super(message, 400, \"VALIDATION_ERROR\");\r\n    this.name = \"ValidationError\";\r\n  }\r\n}\r\n\r\nexport class NotFoundError extends ApiError {\r\n  constructor(message: string) {\r\n    super(message, 404, \"NOT_FOUND\");\r\n    this.name = \"NotFoundError\";\r\n  }\r\n}\r\n\r\nexport class UnauthorizedError extends ApiError {\r\n  constructor(message: string = \"Unauthorized\") {\r\n    super(message, 401, \"UNAUTHORIZED\");\r\n    this.name = \"UnauthorizedError\";\r\n  }\r\n}\r\n\r\nexport class ForbiddenError extends ApiError {\r\n  constructor(message: string = \"Forbidden\") {\r\n    super(message, 403, \"FORBIDDEN\");\r\n    this.name = \"ForbiddenError\";\r\n  }\r\n}\r\n\r\nexport class ConflictError extends ApiError {\r\n  constructor(message: string) {\r\n    super(message, 409, \"CONFLICT\");\r\n    this.name = \"ConflictError\";\r\n  }\r\n}\r\n\r\nexport class InternalServerError extends ApiError {\r\n  constructor(message: string = \"Internal Server Error\") {\r\n    super(message, 500, \"INTERNAL_SERVER_ERROR\");\r\n    this.name = \"InternalServerError\";\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA,uCAAuC;;;;;;;;;;;;;;;;;AAEhC,MAAM,iBAAiB;;;;IAC5B,YACE,AAAO,OAAe,EACtB,AAAO,SAAiB,GAAG,EAC3B,AAAO,IAAa,CACpB;QACA,KAAK,CAAC,eAJC,UAAA,cACA,SAAA,aACA,OAAA;QAGP,IAAI,CAAC,IAAI,GAAG;IACd;AACF;AAEO,MAAM,wBAAwB;;IACnC,YAAY,OAAe,EAAE,AAAO,KAAc,CAAE;QAClD,KAAK,CAAC,SAAS,KAAK,0BADc,QAAA;QAElC,IAAI,CAAC,IAAI,GAAG;IACd;AACF;AAEO,MAAM,sBAAsB;IACjC,YAAY,OAAe,CAAE;QAC3B,KAAK,CAAC,SAAS,KAAK;QACpB,IAAI,CAAC,IAAI,GAAG;IACd;AACF;AAEO,MAAM,0BAA0B;IACrC,YAAY,UAAkB,cAAc,CAAE;QAC5C,KAAK,CAAC,SAAS,KAAK;QACpB,IAAI,CAAC,IAAI,GAAG;IACd;AACF;AAEO,MAAM,uBAAuB;IAClC,YAAY,UAAkB,WAAW,CAAE;QACzC,KAAK,CAAC,SAAS,KAAK;QACpB,IAAI,CAAC,IAAI,GAAG;IACd;AACF;AAEO,MAAM,sBAAsB;IACjC,YAAY,OAAe,CAAE;QAC3B,KAAK,CAAC,SAAS,KAAK;QACpB,IAAI,CAAC,IAAI,GAAG;IACd;AACF;AAEO,MAAM,4BAA4B;IACvC,YAAY,UAAkB,uBAAuB,CAAE;QACrD,KAAK,CAAC,SAAS,KAAK;QACpB,IAAI,CAAC,IAAI,GAAG;IACd;AACF","debugId":null}},
    {"offset": {"line": 285, "column": 0}, "map": {"version":3,"sources":["file:///D:/G/Aerocity/AEROCITY-FE/Aerocity/app/api/auth/me/route.ts"],"sourcesContent":["// app/api/auth/me/route.ts\r\nimport { NextRequest, NextResponse } from \"next/server\";\r\nimport { extractTokenFromHeader, verifyToken } from \"@/lib/jwt-utils\";\r\nimport { prisma } from \"@/lib/db\";\r\nimport { createSuccessResponse, createErrorResponse } from \"@/lib/responses\";\r\nimport { UnauthorizedError } from \"@/lib/errors\";\r\n\r\nexport async function GET(request: NextRequest) {\n  try {\n    // Prefer bearer token; fall back to auth cookie for browser sessions.\n    const authHeader = request.headers.get(\"Authorization\") ?? undefined;\n    let token = extractTokenFromHeader(authHeader);\n\n    if (!token) {\n      const authCookie = request.cookies.get(\"aerocity_auth\")?.value;\n      if (authCookie) {\n        try {\n          const parsed = JSON.parse(authCookie);\n          if (parsed && typeof parsed.token === \"string\") {\n            token = parsed.token;\n          }\n        } catch {\n          // Ignore malformed cookie and continue to unauthorized handling.\n        }\n      }\n    }\n\n    if (!token) {\n      throw new UnauthorizedError(\"Missing or invalid authentication token\");\n    }\n\r\n    // Verify token\r\n    const payload = verifyToken(token);\r\n    if (!payload) {\r\n      throw new UnauthorizedError(\"Invalid or expired token\");\r\n    }\r\n\r\n    // Fetch user from database to get current data\r\n    const user = await prisma.user.findUnique({\r\n      where: { id: payload.userId },\r\n    });\r\n\r\n    if (!user) {\r\n      throw new UnauthorizedError(\"User not found\");\r\n    }\r\n\r\n    if (user.status !== \"ACTIVE\") {\r\n      throw new UnauthorizedError(\r\n        `Account is ${user.status.toLowerCase()}. Please contact administrator.`,\r\n      );\r\n    }\r\n\r\n    const responseData = {\n      token,\n      user: {\n        id: user.id,\n        name: user.name,\n        mobile: user.mobile,\n        email: user.email,\n        role: user.role,\n        status: user.status,\n      },\n    };\n\r\n    return NextResponse.json(\r\n      createSuccessResponse(\"Current user retrieved\", responseData),\r\n      { status: 200 },\r\n    );\r\n  } catch (error: any) {\r\n    console.error(\"Get current user error:\", error);\r\n\r\n    if (error instanceof UnauthorizedError) {\r\n      return NextResponse.json(\r\n        createErrorResponse(\r\n          \"Authentication failed\",\r\n          error.message,\r\n          \"UNAUTHORIZED\",\r\n        ),\r\n        { status: 401 },\r\n      );\r\n    }\r\n\r\n    return NextResponse.json(\r\n      createErrorResponse(\r\n        \"Failed to retrieve user\",\r\n        error.message || \"Internal server error\",\r\n      ),\r\n      { status: 500 },\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA,2BAA2B;;;;;AAC3B;AACA;AACA;AACA;AACA;;;;;;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,sEAAsE;QACtE,MAAM,aAAa,QAAQ,OAAO,CAAC,GAAG,CAAC,oBAAoB;QAC3D,IAAI,QAAQ,IAAA,+IAAsB,EAAC;QAEnC,IAAI,CAAC,OAAO;YACV,MAAM,aAAa,QAAQ,OAAO,CAAC,GAAG,CAAC,kBAAkB;YACzD,IAAI,YAAY;gBACd,IAAI;oBACF,MAAM,SAAS,KAAK,KAAK,CAAC;oBAC1B,IAAI,UAAU,OAAO,OAAO,KAAK,KAAK,UAAU;wBAC9C,QAAQ,OAAO,KAAK;oBACtB;gBACF,EAAE,OAAM;gBACN,iEAAiE;gBACnE;YACF;QACF;QAEA,IAAI,CAAC,OAAO;YACV,MAAM,IAAI,oIAAiB,CAAC;QAC9B;QAEA,eAAe;QACf,MAAM,UAAU,IAAA,oIAAW,EAAC;QAC5B,IAAI,CAAC,SAAS;YACZ,MAAM,IAAI,oIAAiB,CAAC;QAC9B;QAEA,+CAA+C;QAC/C,MAAM,OAAO,MAAM,qHAAM,CAAC,IAAI,CAAC,UAAU,CAAC;YACxC,OAAO;gBAAE,IAAI,QAAQ,MAAM;YAAC;QAC9B;QAEA,IAAI,CAAC,MAAM;YACT,MAAM,IAAI,oIAAiB,CAAC;QAC9B;QAEA,IAAI,KAAK,MAAM,KAAK,UAAU;YAC5B,MAAM,IAAI,oIAAiB,CACzB,CAAC,WAAW,EAAE,KAAK,MAAM,CAAC,WAAW,GAAG,+BAA+B,CAAC;QAE5E;QAEA,MAAM,eAAe;YACnB;YACA,MAAM;gBACJ,IAAI,KAAK,EAAE;gBACX,MAAM,KAAK,IAAI;gBACf,QAAQ,KAAK,MAAM;gBACnB,OAAO,KAAK,KAAK;gBACjB,MAAM,KAAK,IAAI;gBACf,QAAQ,KAAK,MAAM;YACrB;QACF;QAEA,OAAO,gRAAY,CAAC,IAAI,CACtB,IAAA,2IAAqB,EAAC,0BAA0B,eAChD;YAAE,QAAQ;QAAI;IAElB,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,2BAA2B;QAEzC,IAAI,iBAAiB,oIAAiB,EAAE;YACtC,OAAO,gRAAY,CAAC,IAAI,CACtB,IAAA,yIAAmB,EACjB,yBACA,MAAM,OAAO,EACb,iBAEF;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAO,gRAAY,CAAC,IAAI,CACtB,IAAA,yIAAmB,EACjB,2BACA,MAAM,OAAO,IAAI,0BAEnB;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}