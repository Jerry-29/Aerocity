{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/middleware.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport type { NextRequest } from \"next/server\";\r\n\r\nexport function middleware(request: NextRequest) {\r\n  const { pathname } = request.nextUrl;\r\n\r\n  // Bypass auth in development mode for testing\r\n  const bypassAuth = process.env.NEXT_PUBLIC_BYPASS_AUTH === \"true\";\r\n  if (bypassAuth && (pathname.startsWith(\"/admin\") || pathname.startsWith(\"/agent\"))) {\r\n    return NextResponse.next();\r\n  }\r\n\r\n  // Allow login page through\r\n  if (pathname === \"/login\") {\r\n    const authCookie = request.cookies.get(\"aerocity_auth\");\r\n    if (authCookie) {\r\n      try {\r\n        const data = JSON.parse(authCookie.value);\r\n        const role = data.user?.role;\r\n        if (role === \"ADMIN\") {\r\n          return NextResponse.redirect(new URL(\"/admin\", request.url));\r\n        }\r\n        if (role === \"AGENT\") {\r\n          return NextResponse.redirect(new URL(\"/agent\", request.url));\r\n        }\r\n      } catch {\r\n        // Invalid cookie, let them see login\r\n      }\r\n    }\r\n    return NextResponse.next();\r\n  }\r\n\r\n  // Protect admin routes\r\n  if (pathname.startsWith(\"/admin\")) {\r\n    const authCookie = request.cookies.get(\"aerocity_auth\");\r\n    if (!authCookie) {\r\n      return NextResponse.redirect(new URL(\"/login\", request.url));\r\n    }\r\n    try {\r\n      const data = JSON.parse(authCookie.value);\r\n      if (data.user?.role !== \"ADMIN\") {\r\n        return NextResponse.redirect(new URL(\"/login\", request.url));\r\n      }\r\n    } catch {\r\n      return NextResponse.redirect(new URL(\"/login\", request.url));\r\n    }\r\n    return NextResponse.next();\r\n  }\r\n\r\n  // Protect agent routes\r\n  if (pathname.startsWith(\"/agent\")) {\r\n    const authCookie = request.cookies.get(\"aerocity_auth\");\r\n    if (!authCookie) {\r\n      return NextResponse.redirect(new URL(\"/login\", request.url));\r\n    }\r\n    try {\r\n      const data = JSON.parse(authCookie.value);\r\n      if (data.user?.role !== \"AGENT\") {\r\n        return NextResponse.redirect(new URL(\"/login\", request.url));\r\n      }\r\n    } catch {\r\n      return NextResponse.redirect(new URL(\"/login\", request.url));\r\n    }\r\n    return NextResponse.next();\r\n  }\r\n\r\n  return NextResponse.next();\r\n}\r\n\r\nexport const config = {\r\n  matcher: [\"/admin/:path*\", \"/agent/:path*\", \"/login\"],\r\n};\r\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;;AAGO,SAAS,WAAW,OAAoB;IAC7C,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;IAEpC,8CAA8C;IAC9C,MAAM,aAAa,6CAAwC;IAC3D,IAAI,cAAc,CAAC,SAAS,UAAU,CAAC,aAAa,SAAS,UAAU,CAAC,SAAS,GAAG;QAClF,OAAO,gUAAY,CAAC,IAAI;IAC1B;IAEA,2BAA2B;IAC3B,IAAI,aAAa,UAAU;QACzB,MAAM,aAAa,QAAQ,OAAO,CAAC,GAAG,CAAC;QACvC,IAAI,YAAY;YACd,IAAI;gBACF,MAAM,OAAO,KAAK,KAAK,CAAC,WAAW,KAAK;gBACxC,MAAM,OAAO,KAAK,IAAI,EAAE;gBACxB,IAAI,SAAS,SAAS;oBACpB,OAAO,gUAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;gBAC5D;gBACA,IAAI,SAAS,SAAS;oBACpB,OAAO,gUAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;gBAC5D;YACF,EAAE,OAAM;YACN,qCAAqC;YACvC;QACF;QACA,OAAO,gUAAY,CAAC,IAAI;IAC1B;IAEA,uBAAuB;IACvB,IAAI,SAAS,UAAU,CAAC,WAAW;QACjC,MAAM,aAAa,QAAQ,OAAO,CAAC,GAAG,CAAC;QACvC,IAAI,CAAC,YAAY;YACf,OAAO,gUAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;QAC5D;QACA,IAAI;YACF,MAAM,OAAO,KAAK,KAAK,CAAC,WAAW,KAAK;YACxC,IAAI,KAAK,IAAI,EAAE,SAAS,SAAS;gBAC/B,OAAO,gUAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;YAC5D;QACF,EAAE,OAAM;YACN,OAAO,gUAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;QAC5D;QACA,OAAO,gUAAY,CAAC,IAAI;IAC1B;IAEA,uBAAuB;IACvB,IAAI,SAAS,UAAU,CAAC,WAAW;QACjC,MAAM,aAAa,QAAQ,OAAO,CAAC,GAAG,CAAC;QACvC,IAAI,CAAC,YAAY;YACf,OAAO,gUAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;QAC5D;QACA,IAAI;YACF,MAAM,OAAO,KAAK,KAAK,CAAC,WAAW,KAAK;YACxC,IAAI,KAAK,IAAI,EAAE,SAAS,SAAS;gBAC/B,OAAO,gUAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;YAC5D;QACF,EAAE,OAAM;YACN,OAAO,gUAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;QAC5D;QACA,OAAO,gUAAY,CAAC,IAAI;IAC1B;IAEA,OAAO,gUAAY,CAAC,IAAI;AAC1B;AAEO,MAAM,SAAS;IACpB,SAAS;QAAC;QAAiB;QAAiB;KAAS;AACvD"}}]
}